---
title: "R Notebook"
output: html_notebook
---

                                        # Fragestellung: Wieso gestalltet sich die Finanzierung der AHV so schwierig?
                                        
                                        
                                        
                                        
                                                  # Packete importieren und Daten einlesen und vorbereiten
# Packete importieren
```{r}
library(esquisse)
library(ggplot2)
library(tidyverse)
library(magrittr)
library(rmarkdown)
```

# Daten einlesen
```{r}
data_csv <- read.csv2("DatensatzAbstimmungen.csv", na = "NA")
```

# Datum Spalte zu Datentyp "date" ändern
```{r}
data_csv <- data_csv%>%
  mutate(datum=as.Date(datum, "%d.%m.%Y"))

class(data_csv$datum)
```

# Datensatz nur mit AHV Abstimmungen erstellen
```{r}
ahv <- subset(data_csv, anr == 99 |anr == 101 | anr == 115 | anr == 144 | anr == 280 | anr == 281 |anr == 352 |anr == 401 | anr == 423 | anr == 444 | anr == 469 |anr == 481 |anr == 489.1   | anr == 489.2  | anr == 507 | anr == 508 | anr == 523 |anr == 536 |anr == 594 | anr == 606 | anr == 614 |anr == 627 |anr == 401 |anr == 422)
```

# Bei AHV Datensatz Spalte annahme 1,0 durch Worte ersetzen
```{r}
ahv$annahme[ahv$annahme == "0"] <- "Abgelehnt"
ahv$annahme[ahv$annahme == "1"] <- "Angenommen"
```









                                           # Grafik 1 (Blog): Aufteilung der Themen in den AHV-Abstimmungen

# Data Frame mit benötigten Kateogiren erstellen (im Vorfeld entschieden, was zu welcher Karegorie gehört. Noch aufschreiben)
```{r}
kategorien <- c("Finanzierung","Revision","Rentenalter", "Anderes")
Anzahl <- c(11,4,4,5)

dfKategorien <- data.frame(kategorien,Anzahl)
```

# Plot erstellen
```{r}
ggplot(dfKategorien) +
 aes(x = kategorien, weight = Anzahl) +
 geom_bar(fill = "#0C4C8A") +
 labs(x = " ", y = " ") +
  labs(
    title = "Aufteilung der Themen in den AHV-Abstimmungen")+
  theme(plot.title = element_text(size = 15L, hjust = 0.5))+
 theme_minimal()
```







                                                  # Grafik 2: Alle Abstimmungen über die AHV seit 1848

# DataFrame nur mit Datum, Abstimmung und Ergebnis
```{r}
ahv_Ergebnisse <- subset(ahv, select=c(datum,titel_kurz_d,annahme,volkja.proz))
```
# Plot erstellen
```{r}
ggplot(ahv_Ergebnisse) +
 aes(x = datum, fill = annahme) +
 geom_histogram(bins = 31L) +
 scale_fill_hue(direction = 1) +
 labs(x = " ", y = "Anzahl Abstimmungen") +
 theme_minimal()+
 scale_fill_manual('Ergebnis', values=c('#0C4C8A', 'tan2'))+
   labs(
    title = "Alle Abstimmungen über die AHV seit 1848")+
  theme(plot.title = element_text(size = 15L, hjust = 0.5))
```






                               # Abstimmungen mit Militär in Verbindung mit Finanzierung und Medien mit Finanzierung suchen
                               
# Zeilen suchen wo d1e1 == 3 oder d1e1 == 12 (3= Sicherheitspolitik, 12 = Kultur, Bldung, Medien)
```{r}
d1e1_3_oder_12 <- subset(data_csv, d1e1 == 3 | d1e1 == 12)
```

# Zeilen suchen wo d1e2 == 3.2(Militär) oder 12.5(Medien)
```{r}
d1e2_3.2_oder_12.5 <- subset(d1e1_3_oder_12, d1e2 == 3.2 | d1e2 == 12.5)
```

# Was hat davon (Data Frame d1e2_3.2_oder_12.5) mit Finanzen zu tun?
```{r}
abstimmungen_militär_finanzierung <- subset(d1e2_3.2_oder_12.5, d2e1 == 6)

# Hier als Ergebnis nur Abstimmungen mit Verbindung zum Militär rausgekommen, deshalb Name darauf geändert.
```

# Filtern nach Abstimmungen mit Medien
```{r}
d1e2_12.5 <- subset(d1e1_3_oder_12, d1e2 == 12.5)
```






                                              # Grafik 4: Abstimmungsergebnisse im Bereich der AHV-Finanzierung
                                                    
# Data Frame mit AHV-Abstimmungen im Bereich Finanzierung erstellen
```{r}
ahv_Finanzierung <- subset(ahv, anr==401 |anr == 481 | anr == 489.1 | anr == 489.2 | anr == 508 | anr == 523 | anr == 594 | anr == 606 | anr == 614 | anr == 627)
```

# Wie oft abgelehnt / angenommen?
```{r}
zahlen_ang_abg <- ahv_Finanzierung %>%
  group_by(annahme) %>%
  count()
```

# Plot erstellen
```{r}
ggplot(zahlen_ang_abg, aes(x="", y=n, fill=annahme))+
  geom_bar(stat="identity", width = 1)+
  coord_polar("y",start=0)+
  geom_text(aes(label = paste0((round(100/10)*n), "%")), position = position_stack(vjust=0.5),color="white") +
  labs(x = NULL, y = NULL, fill = NULL) +
  theme_classic() +
  theme(axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank()) +
  scale_fill_manual(values=c("#0C4C8A","tan2"))+
    labs(
    title = "Abstimmungsergebnisse im Bereich der AHV-Finanzierung")+
  theme(plot.title = element_text(size = 15L, hjust = 0.5))
```









                                             # Grafik 5: Abstimmungsergebnisse im Bereich Medien in Verbindung mit Finanzierung
# Pie Chart Medien in Verbindung mit Finanzierungen
```{r}
# DataFrame erstellen mit Abgelehnt:2 und Angenommen:2
annahme <- c("Angenommen", "Abgelehnt")
n <- c(2,2)
dfMedien <- data.frame(annahme,n)

```

```{r}
ggplot(dfMedien, aes(x="", y=n, fill=annahme))+
  geom_bar(stat="identity", width = 1)+
  coord_polar("y",start=0)+
  geom_text(aes(label = paste0(round((100/4)*n), "%")), position = position_stack(vjust=0.5),color = "white") +
  labs(x = NULL, y = NULL, fill = NULL) +
  theme_classic() +
  theme(axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank()) +
  scale_fill_manual(values=c("#0C4C8A","tan2"))+
    labs(
    title = "Abstimmungsergebnisse im Bereich Medien in Verbindung mit Finanzierung")+
  theme(plot.title = element_text(size = 15L, hjust = 0.2))
```
                  
                  
                  
                  
                  
                  
                  
                  
                                            # Grafik 6: Abstimmungsergebnisse im Bereich Militär in Verbindung mit Finanzierung
                  
# Pie Chart Militär in Verbindung mit Finanzierungen
```{r}
# DataFrame erstellen mit Abgelehnt:2 und Angenommen:2
annahme <- c("Angenommen", "Abgelehnt")
n <- c(7,4)
dfMilitär <- data.frame(annahme,n)

```
```{r}
ggplot(dfMilitär, aes(x="", y=n, fill=annahme))+
  geom_bar(stat="identity", width = 1)+
  coord_polar("y",start=0)+
  geom_text(aes(label = paste0(round((100/11)*n), "%")), position = position_stack(vjust=0.5),color="white") +
  labs(x = NULL, y = NULL, fill = NULL) +
  theme_classic() +
  theme(axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank()) +
  scale_fill_manual(values=c("#0C4C8A","tan2"))+
    labs(
    title = "Abstimmungsergebnisse im Bereich Militär in Verbindung mit Finanzierung")+
  theme(plot.title = element_text(size = 15L, hjust = 0.2))
```
                  
                  
                  
                  
                  
                  
                  
                  
                





                                                             # Überprüfung der Theorien
                                                             
# Data Frame mit Medien- Militär- und AHV- Finanzierungsabstimmungen erstellen
```{r}
finanzierungen <- subset(data_csv, anr == 16 | anr == 18 | anr == 86 |anr == 131 | anr == 161 | anr == 162 |anr == 181 |  anr == 393 | anr == 401 |anr == 481 |anr == 489.1  | anr == 489.2 | anr == 508 | anr == 523 |anr == 594 | anr == 606 | anr == 614 |anr == 627 |  anr == 427 | anr == 471 | anr == 584 | anr == 635|  anr == 595 | anr == 617 | anr == 654)
```

# Data Frame Kürzen
```{r}
finanzierungen_gekuerzt <- subset(finanzierungen, select=c(anr,datum,titel_kurz_d,d1e1,annahme,br.pos,bv.pos,nr.pos))
```

# br.pos als int. speichern
```{r}
#finanzierungen_gekuerzt$br.pos <- as.factor(finanzierungen_gekuerzt$br.pos )
```

# Kategorien setzen gemäss Spalte d1e1
```{r}
finanzierungen_gekuerzt$d1e1[finanzierungen_gekuerzt$d1e1 == "3"] <- "Militär"
finanzierungen_gekuerzt$d1e1[finanzierungen_gekuerzt$d1e1 == "12"] <- "Medien"
finanzierungen_gekuerzt$d1e1[finanzierungen_gekuerzt$d1e1 == "10"] <- "AHV"
finanzierungen_gekuerzt$d1e1[finanzierungen_gekuerzt$d1e1 == "6"] <- "AHV"
finanzierungen_gekuerzt$d1e1[finanzierungen_gekuerzt$d1e1 == "7"] <- "AHV"
finanzierungen_gekuerzt$d1e1[finanzierungen_gekuerzt$d1e1 == "4"] <- "AHV"
```

# Bei Position Bundesrat Zahlen mit Wörtern ersetzen
```{r}
finanzierungen_gekuerzt$br.pos[finanzierungen_gekuerzt$br.pos == "1"] <- "Befürwortend"
finanzierungen_gekuerzt$br.pos[finanzierungen_gekuerzt$br.pos == "2"] <- "Ablehnend"
finanzierungen_gekuerzt$br.pos[finanzierungen_gekuerzt$br.pos == "."] <- "Enthaltend"
```

# Bei Position Parlament Zahlen mit Wörtern ersetzen
```{r}
finanzierungen_gekuerzt$bv.pos[finanzierungen_gekuerzt$bv.pos == "1"] <- "Befürwortend"
finanzierungen_gekuerzt$bv.pos[finanzierungen_gekuerzt$bv.pos == "2"] <- "Ablehnend"
```

# Bei Position Nationalrat Zahlen mit Wörtern ersetzen
```{r}
finanzierungen_gekuerzt$nr.pos[finanzierungen_gekuerzt$nr.pos == "1"] <- "Befürwortend"
finanzierungen_gekuerzt$nr.pos[finanzierungen_gekuerzt$nr.pos == "2"] <- "Ablehnend"
```

# 0 und 1 durch Abgelehnt und Angenommen ersetzen
```{r}
finanzierungen_gekuerzt$annahme[finanzierungen_gekuerzt$annahme == "0"] <- "Abgelehnt"
finanzierungen_gekuerzt$annahme[finanzierungen_gekuerzt$annahme == "1"] <- "Angenommen"
```





# Plot Abstimmungen im Bereich AHV, Medien, Militär in Verbindung mit Finanzierung und ob diese angenommen oder abgelehnt wurden und die Position des Bundesrates
```{r}
ggplot(finanzierungen_gekuerzt) +
  aes(x = annahme, fill = br.pos) +
  geom_bar() +
  scale_fill_manual(
    values = c(Ablehnend = "#0C4C8A",
    Befürwortend = "tan2",
    `Enthaltend` = "grey")
  ) +
  labs(
    x = "Entscheidung des Volkes",
    y = "Anzahl Abstimmungen",
    title = "Analyse der Haltung des Bundesrates",
    fill = "Position Bundesrat"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  ) +
  facet_wrap(vars(d1e1))
```








# Plot Abstimmungen im Bereich AHV, Medien, Militär in Verbindung mit Finanzierung und ob diese angenommen oder abgelehnt wurden und die Position des Parlaments
```{r}
ggplot(finanzierungen_gekuerzt) +
  aes(x = annahme, fill = bv.pos) +
  geom_bar() +
  scale_fill_manual(
    values = c(Ablehnend = "#0C4C8A",
    Befürwortend = "tan2")
  ) +
  labs(
    x = "Entscheidung des Volkes",
    y = "Anzahl Abstimmungen",
    title = "Analyse der Haltung des Parlaments",
    fill = "Position Parlament"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  ) +
  facet_wrap(vars(d1e1))
```




# Plot Abstimmungen im Bereich AHV, Medien, Militär in Verbindung mit Finanzierung und ob diese angenommen oder abgelehnt wurden und die Position des Nationalrats
```{r}
ggplot(finanzierungen_gekuerzt) +
  aes(x = annahme, fill = nr.pos) +
  geom_bar() +
  scale_fill_manual(
    values = c(Ablehnend = "#0C4C8A",
    Befürwortend = "tan2")
  ) +
  labs(
    x = "Entscheidung des Volkes",
    y = "Anzahl Abstimmungen",
    title = "Analyse der Haltung des Nationalrates",
    fill = "Position Nationalrat"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  ) +
  facet_wrap(vars(d1e1))
```

# Kontrollieren, ob Initiative nie angenommen, wenn Bundesrat dagegen
```{r}
bundesratDagegen <- filter(finanzierungen, br.pos == 2)
```
```{r}
test_finanzierungen <- bundesratDagegen %>%
  group_by(annahme) %>%
  count()
```





                                                                     # Grafik 10


```{r}
ablehnung <- subset(ahv_Ergebnisse, annahme == "Abgelehnt") 
ablehnung$volkja.proz_n <-as.numeric(ablehnung$volkja.proz)
```

```{r}
ggplot(ablehnung) +
  aes(
    x = volkja.proz_n,
    y = titel_kurz_d,
    colour = volkja.proz_n
  ) +
  geom_point(shape = "circle", size = 4L) +
  scale_color_gradient(low = "#0C4C8A", high = "tan1") +
  labs(
    x = "Prozentualer Anteil der Ja-Stimmen",
    y = " ",
    title = "Prozentualer Anteil Ja-Stimmen bei abgelehnten AHV-Initiativen",
    color = "Prozentanteil"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  ) + 
  theme(text = element_text(size = 20)) 
```














                                                                     # Grafik 11


# Data Frame erstellen mit Haltung der Parteien zu AHV Abstimmungen in Verbindung mit Finanzierungen
```{r}
ahv_finanzierungen_parteien <- subset(ahv_Finanzierung, select=c(titel_kurz_d,annahme,p.svp,p.fdp,p.cvp,p.bdp))
```

# Haltung der Parteien durch Worte ersetzen
```{r}
ahv_finanzierungen_parteien$p.svp[ahv_finanzierungen_parteien$p.svp == "1"] <- "Ja-Parole"
ahv_finanzierungen_parteien$p.svp[ahv_finanzierungen_parteien$p.svp == "2"] <- "Nein-Parole"
ahv_finanzierungen_parteien$p.svp[ahv_finanzierungen_parteien$p.svp == "5"] <- "Der Akteur beschloss Stimmfreigabe"

ahv_finanzierungen_parteien$p.fdp[ahv_finanzierungen_parteien$p.fdp == "1"] <- "Ja-Parole"
ahv_finanzierungen_parteien$p.fdp[ahv_finanzierungen_parteien$p.fdp == "2"] <- "Nein-Parole"

ahv_finanzierungen_parteien$p.cvp[ahv_finanzierungen_parteien$p.cvp == "1"] <- "Ja-Parole"
ahv_finanzierungen_parteien$p.cvp[ahv_finanzierungen_parteien$p.cvp == "2"] <- "Nein-Parole"

ahv_finanzierungen_parteien$p.bdp[ahv_finanzierungen_parteien$p.bdp == "1"] <- "Ja-Parole"
ahv_finanzierungen_parteien$p.bdp[ahv_finanzierungen_parteien$p.bdp == "2"] <- "Nein-Parole"
ahv_finanzierungen_parteien$p.bdp[ahv_finanzierungen_parteien$p.bdp == "9999"] <- "Organisation existiert nicht"
```

```{r}
ggplot(ahv_finanzierungen_parteien) +
 aes(x = annahme, y = titel_kurz_d, fill = p.svp) +
 geom_tile(size = 1.2) +
 scale_fill_manual(values = c(`Der Akteur beschloss Stimmfreigabe` = "grey", `Ja-Parole` = "tan2", 
 `Nein-Parole` = "#0C4C8A")) +
 labs(x = "xxx", y = "yyy", title = "Titel", fill = "Titel Label") +
 theme_minimal() +
 theme(plot.title = element_text(size = 15L, face = "bold", hjust = 0.5), axis.title.y = element_text(size = 12L, 
 face = "bold"), axis.title.x = element_text(size = 12L, face = "bold"))

```

```{r}
ggplot(ahv_finanzierungen_parteien) +
  aes(x = annahme, y = titel_kurz_d, fill = p.fdp) +
  geom_tile(size = 1.2) +
  scale_fill_manual(
    values = c(`Ja-Parole` = "tan2",
    `Nein-Parole` = "#0C4C8A")
  ) +
  labs(
    x = "xxx",
    y = "yyy",
    title = "Titel",
    fill = "Titel Label"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  )
```


```{r}
ggplot(ahv_finanzierungen_parteien) +
  aes(x = annahme, y = titel_kurz_d, fill = p.bdp) +
  geom_tile(size = 1.2) +
  scale_fill_manual(
    values = c(`Ja-Parole` = "tan2",
    `Nein-Parole` = "#0C4C8A",
    `Organisation existiert nicht` = "grey")
  ) +
  labs(x = "xxx", y = "yyy", title = "Titel", fill = "Titel") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  ) +
  facet_wrap(vars(p.bdp))
```





 
 
 

```{r}
jaParole <- subset(ahv_Finanzierung, select = c(titel_kurz_d, annahme, ja.lager))
```




# ja.lager als int speichern
```{r}
#jaParole$ja.lager <- as.factor(jaParole$ja.lager)
```


```{r}
jaParole$ja.lager[jaParole$ja.lager > "50" ] <- "Mehr als 50%"
jaParole$ja.lager[jaParole$ja.lager <= "50" ] <- "Weniger oder genau 50 %"
```


```{r}
ggplot(jaParole) +
  aes(x = ja.lager, y = titel_kurz_d, fill = annahme) +
  geom_tile(size = 1.2) +
  scale_fill_manual(
    values = c(Abgelehnt = "#F8766D",
    Angenommen = "#FF61C3")
  ) +
  labs(x = "ddd", y = "fff", title = "Titel", fill = "hdhdh") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  )
```


```{r}
data_csv_nur01 <- subset(data_csv, annahme == 0 | annahme == 1)
```

```{r}
data_csv_nur01_annahme <- subset(data_csv_nur01, select = c(annahme, ja.lager))
```

```{r}
data_csv_nur01_annahme$ja.lager[data_csv_nur01_annahme$ja.lager >= "50" ] <- "50% oder mehr"
data_csv_nur01_annahme$ja.lager[data_csv_nur01_annahme$ja.lager < "50" ] <- "Weniger als 50%"
```

```{r}
data_csv_nur01_annahme$annahme[data_csv_nur01_annahme$annahme == "0" ] <- "Abgelehnt"
data_csv_nur01_annahme$annahme[data_csv_nur01_annahme$annahme == "1" ] <- "Angenommen"
```

```{r}
ggplot(data_csv_nur01_annahme) +
  aes(x = annahme, fill = ja.lager) +
  geom_bar() +
  scale_fill_manual(
    values = c(`50% oder mehr` = "tan2",
    `Weniger als 50%` = "#0C4C8A")
  ) +
  labs(x = "xxx", y = "yyy", title = "Titel", fill = "Blabla") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold"),
    axis.title.x = element_text(size = 12L,
    face = "bold")
  )
```


















                          # Grafik 1 (Demokratie):  bei Erklärung Demokratie: Übersicht in welcher Rechtsform wie oft abgestimmt wurde
# Data Frame anpassen
```{r}
data_csv$rechtsform[data_csv$rechtsform == "1"] <- "Obligatorisches Referendum"
data_csv$rechtsform[data_csv$rechtsform == "2"] <- "Fakultatives Referendum"
data_csv$rechtsform[data_csv$rechtsform == "3"] <- "Volksinitiative"
data_csv$rechtsform[data_csv$rechtsform == "4"] <- "Direkter Gegenentwurf einer Volksinitiative"
data_csv$rechtsform[data_csv$rechtsform == "5"] <- "Stichfrage"
```

# Plot erstellen
```{r}
ggplot(data_csv) +
  aes(x = rechtsform, fill = rechtsform) +
  geom_bar() +
  scale_fill_manual(
    values = c(`Direkter Gegenentwurf einer Volksinitiative` = "#A50026",
    `Fakultatives Referendum` = "#F88D51",
    `Obligatorisches Referendum` = "#E6D386",
    Stichfrage = "#8FC3DD",
    Volksinitiative = "#313695")
  ) +
  labs(y = "Anzahl Initiativen", fill = "Rechtsform") +
  theme_minimal() +
  theme(
    axis.title.y = element_text(size = 12L,
    face = "bold")
  )+
    labs(
    title = "Rechtsform der Initiativen seit 1848")+
  theme(plot.title = element_text(size = 15L, hjust = 0.5))
```





                                    # Grafik 2 (Demokratie): Alle Volksinitiativen verteilt auf die Jahre seit 1848
# Data Frame kürzen
```{r}
initiativen <-  subset(data_csv, rechtsform == "Volksinitiative")
```
# Bei AHV Datensatz Spalte annahme 1,0 durch Worte ersetzen
```{r}
initiativen$annahme[initiativen$annahme == "0"] <- "Abgelehnt"
initiativen$annahme[initiativen$annahme == "1"] <- "Angenommen"
```
# Plot erstellen
```{r}
ggplot(initiativen) +
  aes(x = datum, fill = annahme) +
  geom_histogram(bins = 30L) +
  scale_fill_manual(
    values = c(Abgelehnt = "#0C4C8A",
    Angenommen = "tan2")
  ) +
  labs(
    x = " ",
    y = "Anzahl Volksinitiativen",
    title = "Volksinitiativen seit 1848",
    fill = "Ergebnis"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 15L,
    face = "bold",
    hjust = 0.5),
    axis.title.y = element_text(size = 12L,
    face = "bold")
  )
```